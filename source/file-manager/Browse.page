Title="_(Index of)_ $dir"
Tag="navicon"
Nchan="file_manager"
---
<?PHP
/* Copyright 2005-2022, Lime Technology
 * Copyright 2012-2022, Bergware International.
 *
 * This program is free software; you can redistribute it and/or
 * modify it under the terms of the GNU General Public License version 2,
 * as published by the Free Software Foundation.
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 */
?>
<?
function validdir($dir) {
  $path = realpath($dir);
  $root = explode('/',$path)[1] ?? '';
  return in_array($root,['mnt','boot']) ? $path : '';
}
function quote($text) {
  return "'$text'";
}
$active  = '/var/tmp/file.manager.active';
$running = file_exists($active);
$dir     = validdir(htmlspecialchars_decode($dir));
[$null,$root,$main,$next,$rest] = my_explode('/',$dir,5);
$dir     = htmlspecialchars(str_replace('\\','\\\\',$dir));
$lock    = $root=='mnt' ? ($main ?: '---') : ($root=='boot' ? _('flash') : '---');
$isshare = $root=='mnt' && (!$main || !$next || ($main=='rootshare' && !$rest));
$bgcolor = in_array($theme,['white','azure']) ? '#f2f2f2' : '#1c1c1c';
$fgcolor = in_array($theme,['white','azure']) ? '#1c1c1c' : '#f2f2f2';
$incolor = $theme!='gray' ? $bgcolor : '#121510';
$Folder  = $lock=='---' ? 'Device' : ($isshare ? 'Share' : 'Folder');
$folder  = strtolower($Folder);
$editor  = '/boot/config/editor.cfg';

if (!file_exists($editor)) file_put_contents($editor,implode("\n",['','txt','js','php','page','plg','xml','old','bak','log','css']));
?>
<link type="text/css" rel="stylesheet" href="<?autov("/webGui/styles/jquery.ui.css")?>">
<link type="text/css" rel="stylesheet" href="<?autov("/webGui/styles/jquery.filetree.css")?>">
<link type="text/css" rel="stylesheet" href="<?autov("/webGui/styles/jquery.switchbutton.css")?>">
<link type="text/css" rel="stylesheet" href="<?autov("/plugins/dynamix.docker.manager/styles/style-$theme.css")?>">

<style>
.loc{text-align:left!important;padding-left:0!important}
#title span.left{text-transform:none}
table.tablesorter.indexer{margin-top:0}
table.tablesorter.indexer thead th:nth-child(1){width:12px;text-align:left;padding-left:11px}
table.tablesorter.indexer thead th:nth-child(2){width:3%!important}
table.tablesorter.indexer thead th:nth-child(3){width:auto!important}
table.tablesorter.indexer thead th:nth-child(n+4){width:10%!important}
table.tablesorter.indexer thead th:nth-child(9){width:3%!important}
table.tablesorter.indexer tbody tr:hover td{color:#e68a00}
table.tablesorter.indexer tbody tr:hover a{color:#e68a00}
table.tablesorter.indexer tbody tr:hover .fa{color:#e68a00}
table.tablesorter.indexer thead th{text-align:left}
table.tablesorter.indexer tbody td{text-align:left}
table.tablesorter.indexer thead th:last-child{text-align:right}
table.tablesorter.indexer tbody td:last-child{text-align:right}
i[id^="row_"],i[id^="check_"]{cursor:pointer;font-size:1.8rem;color:gray}
td[id^="name_"]{cursor:pointer}
i.fa-warning,i.fa-refresh{margin-right:8px}
input#target{color:<?=$fgcolor?>;width:500px}
div.autoheight{width:100%;overflow-y:auto;margin-top:<?=$themes1?'-30px':'0'?>}
div.info{position:absolute;bottom:4px;width:74%;margin-left:23%}
div.template,div#dialogWindow,input#upload{display:none}
span.filter{position:relative;margin-left:<?=$themes1?'12':'0'?>px;top:-<?=$themes1?'2':'8'?>px}
span.filter i{position:absolute;left:10px;top:<?=$themes1?'4':'8'?>px;font-size:1.4rem}
span.text{display:inline-block;width:75%;white-space:normal}
span.device{display:inline-block;float:left}
input.filter{border:none;width:100px;background-color:<?=$incolor?>;margin:-8px 0 0 0;padding-left:30px}
input.filter:focus{background-color:<?=$incolor?>}
dt{width:23%}
select.narrow{margin:0 40px 0 10px}
.fileTree{background:<?=$bgcolor?>;width:500px;max-height:320px;overflow-y:scroll;overflow-x:hidden;position:absolute;z-index:100;display:none}
.ui-dialog .ui-dialog-buttonpane .ui-dialog-buttonset button[disabled]{cursor:default;color:#808080;background:-webkit-gradient(linear,left top,right top,from(#404040),to(#808080)) 0 0 no-repeat,-webkit-gradient(linear,left top,right top,from(#404040),to(#808080)) 0 100% no-repeat,-webkit-gradient(linear,left bottom,left top,from(#404040),to(#404040)) 0 100% no-repeat,-webkit-gradient(linear,left bottom,left top,from(#808080),to(#808080)) 100% 100% no-repeat;background:linear-gradient(90deg,#404040 0,#808080) 0 0 no-repeat,linear-gradient(90deg,#404040 0,#808080) 0 100% no-repeat,linear-gradient(0deg,#404040 0,#404040) 0 100% no-repeat,linear-gradient(0deg,#808080 0,#808080) 100% 100% no-repeat;background-size:100% 2px,100% 2px,2px 100%,2px 100%}
</style>

<script src="<?autov("/webGui/javascript/jquery.filetree.js")?>"></script>
<script src="<?autov("/webGui/javascript/jquery.switchbutton.js")?>"></script>
<script>
String.prototype.patch = function(){return this.replace('rw','x+rw').replace('r-','wx+r').replace('--','rwx');}
String.prototype.proxy = function(){return this.replace('name','row');}
String.prototype.fetch = function(tag){return this.replace('check',tag);}
String.prototype.bring = function(tag){return this.replace('row',tag);}
String.prototype.strip = function(){return this.replace(/\/$/,'');}
String.prototype.quote = function(){return this.replace(/&#34;/g,'"');}
String.prototype.crush = function(len){len=len||70;return this.length<=len ? this : this.slice(0,Math.round(len/2)-2)+'...'+this.slice(-1-Math.round(len/2));}
String.prototype.alter = function(...a){var t=this;for(var i=0;i<a.length;i+=2){t=t.replace(a[i],a[i+1]);} return t;}
String.prototype.build = function(){return this.replace(/\n(<!--!|!-->)\n/g,'');}

// General variables
var box = null;
var running = false;
var previous = '';
var table = null;
var thead = null;

function folderContextMenu(id,button) {
  var opts = [];
  context.init({button:button});
  opts.push({header:"_(Action)_"});
  opts.push({text:"_(Delete)_", icon:"fa-trash-o", action:function(e){e.preventDefault();doAction(1,"<?=_("Delete $Folder")?>",id.proxy());}});
  opts.push({text:"_(Copy)_", icon:"fa-copy", action:function(e){e.preventDefault();doAction(3,"<?=_("Copy $Folder")?>",id.proxy());}});
  opts.push({text:"_(Move)_", icon:"fa-paste", action:function(e){e.preventDefault();doAction(4,"<?=_("Move $Folder")?>",id.proxy());}});
<?if (!$isshare):?>
  opts.push({text:"_(Rename)_", icon:"fa-edit", action:function(e){e.preventDefault();doAction(2,"_(Rename Folder)_",id.proxy());}});
<?endif?>
  opts.push({divider:true});
  opts.push({text:"_(Owner)_", icon:"fa-user-o", action:function(e){e.preventDefault();doAction(9,"_(Change Owner)_",id.proxy());}});
  opts.push({text:"_(Permission)_", icon:"fa-address-book-o", action:function(e){e.preventDefault();doAction(10,"_(Change Permission)_",id.proxy());}});
  opts.push({text:"_(Calculate)_", icon:"fa-calculator", action:function(e){e.preventDefault();doAction(12,"_(Calculate Occupied Space)_",id.proxy());}});
<?if (!$isshare):?>
  opts.push({header:"_(Common)_"});
  opts.push({text:"_(Create)_", icon:"fa-folder-o", action:function(e){e.preventDefault();doAction(0,"_(Create Folder)_",id.proxy());}});
<?if ($dir):?>
  opts.push({text:"_(Upload)_", icon:"fa-upload", action:function(e){e.preventDefault();$('#upload').click();}});
<?endif?>
<?endif?>
  context.attach('#'+id, opts);
}
function fileContextMenu(id,button) {
  var opts = [];
  context.init({button:button});
  opts.push({header:"_(Action)_"});
  opts.push({text:"_(Delete)_", icon:"fa-trash-o", action:function(e){e.preventDefault();doAction(5,"_(Delete File)_",id.proxy());}});
  opts.push({text:"_(Copy)_", icon:"fa-copy", action:function(e){e.preventDefault();doAction(7,"_(Copy File)_",id.proxy());}});
  opts.push({text:"_(Move)_", icon:"fa-paste", action:function(e){e.preventDefault();doAction(8,"_(Move File)_",id.proxy());}});
  opts.push({text:"_(Rename)_", icon:"fa-edit", action:function(e){e.preventDefault();doAction(6,"_(Rename File)_",id.proxy());}});
  opts.push({divider:true});
  opts.push({text:"_(Owner)_", icon:"fa-user-o", action:function(e){e.preventDefault();doAction(9,"_(Change Owner)_",id.proxy());}});
  opts.push({text:"_(Permission)_", icon:"fa-address-book-o", action:function(e){e.preventDefault();doAction(10,"_(Change Permission)_",id.proxy());}});
  opts.push({text:"_(Download)_", icon:"fa-download", action:function(e){e.preventDefault();doAction(11,"_(Download File)_",id.proxy());}});
<?if (!$isshare):?>
  opts.push({header:"_(Common)_"});
  opts.push({text:"_(Create)_", icon:"fa-folder-o", action:function(e){e.preventDefault();doAction(0,"_(Create Folder)_",id.proxy());}});
<?if ($dir):?>
  opts.push({text:"_(Upload)_", icon:"fa-upload", action:function(e){e.preventDefault();$('#upload').click();}});
<?endif?>
<?endif?>
  context.attach('#'+id, opts);
}
function deviceFolderContextMenu(dev,id) {
  var opts = [];
  context.init({button:'both'});
  opts.push({header:dev.split('/')[2]});
  opts.push({text:"_(Delete)_", icon:"fa-trash-o", action:function(e){e.preventDefault();doAction(1,"<?=_("Delete $Folder")?>",dev);}});
  opts.push({text:"_(Copy)_", icon:"fa-copy", action:function(e){e.preventDefault();doAction(3,"<?=_("Copy $Folder")?>",dev);}});
  opts.push({text:"_(Move)_", icon:"fa-paste", action:function(e){e.preventDefault();doAction(4,"<?=_("Move $Folder")?>",dev);}});
  opts.push({divider:true});
  opts.push({text:"_(Calculate)_", icon:"fa-calculator", action:function(e){e.preventDefault();doAction(12,"_(Calculate Occupied Space)_",dev);}});
  context.attach('#device_'+id, opts);
}
function deviceFileContextMenu(dev,id) {
  var opts = [];
  context.init({button:'both'});
  opts.push({header:dev.split('/')[2]});
  opts.push({text:"_(Delete)_", icon:"fa-trash-o", action:function(e){e.preventDefault();doAction(5,"_(Delete File)_",dev);}});
  opts.push({text:"_(Copy)_", icon:"fa-copy", action:function(e){e.preventDefault();doAction(7,"_(Copy File)_",dev);}});
  opts.push({text:"_(Move)_", icon:"fa-paste", action:function(e){e.preventDefault();doAction(8,"_(Move File)_",dev);}});
  context.attach('#device_'+id, opts);
}
function resize() {
  $('div.autoheight').height(Math.max(window.innerHeight-320,330));
}
function selectAll() {
  if ($('#check_0').hasClass('fa-square-o')) {
    $('i[id^="check_"]').removeClass('fa-square-o').addClass('fa-check-square-o');
    $('input[class="extra"]').prop('disabled',false);
<?if (!$isshare):?>
    $('input[class="rename"]').prop('disabled',false);
<?endif;?>
  } else {
    $('i[id^="check_"]').removeClass('fa-check-square-o').addClass('fa-square-o');
    $('input[class="extra"]').prop('disabled',true);
<?if (!$isshare):?>
    $('input[class="rename"]').prop('disabled',true);
<?endif;?>
  }
}
function selectOne(id) {
  if ($('#'+id).hasClass('fa-square-o')) {
    $('#'+id).removeClass('fa-square-o').addClass('fa-check-square-o');
  } else {
    $('#'+id).removeClass('fa-check-square-o').addClass('fa-square-o');
  }
  var checked = 0;
  $('i[id^="check_"]').each(function(){if ($(this).prop('id')!='check_0' && $(this).hasClass('fa-check-square-o')) checked++;});
  $('input[class="extra"]').prop('disabled',checked==0);
<?if (!$isshare):?>
  $('input[class="rename"]').prop('disabled',checked==0);
<?endif;?>
}
function errorSource() {
  swal({title:"_(Invalid source)_",text:"_(Not allowed to mix disk and user shares)_",html:true,type:'error',confirmButtonText:"_(Ok)_"});
}
function errorTarget() {
  swal({title:"_(Invalid target)_",text:"_(Enter a valid target)_",html:true,type:'error',confirmButtonText:"_(Ok)_"});
}
function data(id) {
  var data = id.attr('data').quote();
<?if ($isshare):?>
  return id.attr('type')=='d' ? data+'/' : data;
<?else:?>
  return data;
<?endif;?>
}
function escapeHTML(name) {
  const data = document.createElement('div');
  const text = document.createTextNode(name);
  data.appendChild(text);
  return data.innerHTML;
}
function showProgress(data) {
  if (!data) return;
  var file = null;
  var text = data.split('\n');
  var line = text[0].split('... ');
  var strict = /^mnt|^boot/;
  if (text.length==1) {
    text = text[0].crush(80);
  } else {
    if (strict.test(text[1])) {
      file = text[1];
      text = previous;
    } else {
      file = line[1];
      text = text[1].split(/\s+/);
      text = "_(Completed)_: "+text[1]+",&nbsp;&nbsp;_(Speed)_: "+text[2]+",&nbsp;&nbsp;_(ETA)_: "+text[3];
      previous = text;
    }
  }
  if (file==null || strict.test(file)) $('span.text').html((file?line[0]+'... /'+escapeHTML(file.crush())+'<br>':'')+text);
}
function fileManager(action) {
  switch (action) {
  case 'start':
    if (!running) {
<?if (!$running):?>
      clearTimeout(timers.filemonitor);
      filemonitor.stop();
<?endif;?>
      $('.ui-dialog button:contains("_(Proceed)_")').prop('disabled',true);
      filemanager.start();
    }
    running = true;
    break;
  case 'stop':
    if (running) {
      filemanager.stop();
<?if (!$running):?>
      setTimeout(function(){filemonitor.start();},3000);
<?endif;?>
    }
    running = false;
    break;
  }
}
function dialogStyle() {
  $('.ui-dialog-titlebar-close').css({'background':'transparent','border':'none','font-size':'1.8rem','margin-top':'-14px','margin-right':'-18px'}).html('<i class="fa fa-times"></i>').prop('title',"_(Close)_").prop('onclick',null).off('click').click(function(){box.dialog('close');});
  $('.ui-dialog-title').css({'text-align':'center','width':'100%','font-size':'1.8rem'});
  $('.ui-dialog-content').css({'padding-top':'15px','vertical-align':'bottom'});
  $('.ui-button-text').css({'padding':'0px 5px'});
}
function fileName(file) {
  return file.indexOf('/')>=0 ? file.split('/').pop() : file;
}
function fileExtension(file) {
  file = fileName(file);
  return file.indexOf('.')>=0 ? file.split('.').pop() : '';
}
function fileEdit(id) {
  const known = ['','cfg','conf',<?=implode(',',array_map('quote',file($editor,FILE_IGNORE_NEW_LINES|FILE_SKIP_EMPTY_LINES)))?>];
  var source = $('#'+id.proxy()).attr('data').quote();
  var ext = fileExtension(source);
  if (ext == 'zip') {
    // download zip files
    downloadFile(source);
    return;
  }
  box = $("#dialogWindow");
  if (!known.includes(ext)) {
    // file viewer - supported file extensions: .pdf, .jpg, png, .jpeg, .gif
    box.html($("#templateViewFile").html().replace('{$0}',source).build());
    return;
  }
  // file editor dialog
  box.html($("#templateEditFile").html().replace('{$0}',source).build());
  box.dialog({
    title: fileName(source),
    height: Math.min(screen.height*2/3,window.innerHeight-40),
    width: Math.min(screen.width*2/3,window.innerWidth),
    resizable: false,
    modal: true,
    show: {effect:'fade', duration:250},
    hide: {effect:'fade', duration:250},
    buttons: {
      "_(Save)_": function(){
        $.post('/plugins/dynamix.file.manager/include/Browse.php',{mode:'save', file:encodeURIComponent(source), data:encodeURIComponent(editor.session.getValue())});
        box.dialog('close');
      },
      "_(Cancel)_": function(){
        box.dialog('close');
      }
    }
  });
  dialogStyle();
  $('.ui-dialog-titlebar-close').html('<i class="fa fa-expand"></i>').prop('title',"_(Expand)_").prop('onclick',null).off('click').click(function(){fullWindow();});
}
function fullWindow() {
  if ($('.ui-dialog-titlebar-close').html().indexOf('expand')>=0) {
    box.dialog('option','height',window.innerHeight-40);
    box.dialog('option','width',window.innerWidth);
    box.dialog('option','position',{my:'top',at:'top',of:window});
    $('.ui-dialog-titlebar-close').html("<i class='fa fa-compress'></i>").prop("title","_(Compress)_");
  } else {
    box.dialog('option','height',Math.min(screen.height*2/3,window.innerHeight-40));
    box.dialog('option','width',Math.min(screen.width*2/3,window.innerWidth));
    box.dialog('option','position',{my:'center',at:'center',of:window});
    $('.ui-dialog-titlebar-close').html("<i class='fa fa-expand'></i>").prop("title","_(Expand)_");
  }
  editor.resize();
}

var filemanager = new NchanSubscriber('/sub/filemanager',{subscriber:'websocket'});
filemanager.on('message', function(msg) {
  var data = $.parseJSON(msg);
  if (data.error) {
    fileManager('stop');
    $('span.text').addClass('orange-text').html(data.error);
    box.find('#target').prop('disabled',false);
    box.find('#exist').prop('disabled',false);
    box.find('#owner').prop('disabled',false);
    box.find('#group').prop('disabled',false);
    box.find('#other').prop('disabled',false);
  } else {
    showProgress(data.status);
    if (data.done && !timers.filemanager) {
      timers.filemanager = setTimeout(loadList,500);
      fileManager('stop');
      box.dialog('close');
    }
  }
});
<?if ($running):
extract(parse_ini_file($active));
$bulk = count(explode("\r",$source));?>
function showDialog() {
  box = $("#dialogWindow");
  switch (<?=$action?>) {
<?if ($bulk==1):?>
  case 1: // delete folder
    box.html($("#templateDeleteFolder").html());
    box.find('#source').html("<?=$source?>");
    var height = 330;
    break;
  case 3: // copy folder
    box.html($("#templateCopyFolder").html());
    box.find('#source').html("<?=$source?>");
    box.find('#target').val("<?=$target?>").prop('disabled',true);
    var height = 630;
    break;
  case 4: // move folder
    box.html($("#templateMoveFolder").html());
    box.find('#source').html("<?=$source?>");
    box.find('#target').val("<?=$target?>").prop('disabled',true);
    var height = 630;
    break;
  case 5: // delete file
    box.html($("#templateDeleteFile").html());
    box.find('#source').html("<?=$source?>");
    var height = 330;
    break;
  case 7: // copy file
    box.html($("#templateCopyFile").html());
    box.find('#source').html("<?=$source?>");
    box.find('#target').val("<?=$target?>").prop('disabled',true);
    var height = 630;
    break;
  case 8: // move file
    box.html($("#templateMoveFile").html());
    box.find('#source').html("<?=$source?>");
    box.find('#target').val("<?=$target?>").prop('disabled',true);
    var height = 630;
    break;
  case 9: // change owner
    box.html($("#templateChangeOwner").html());
    box.find('#source').html("<?=$source?>");
    box.find('#target').prop('disabled',true);
    var height = 330;
    break;
  case 10: // change permission
    box.html($("#templateChangePermission").html());
    box.find('#source').html("<?=$source?>");
    box.find('#owner').prop('disabled',true);
    box.find('#group').prop('disabled',true);
    box.find('#other').prop('disabled',true);
    var height = 330;
    break;
<?else:?>
  case 1: // delete object
    box.html($("#templateDeleteObject").html());
    box.find('#source').html("_(Objects to delete)_: <?=$bulk?>");
    var height = 330;
    break;
  case 3: // copy object
    box.html($("#templateCopyObject").html());
    box.find('#source').html("_(Objects to copy)_: <?=$bulk?>");
    box.find('#target').val("<?=$target?>").prop('disabled',true);
    var height = 630;
    break;
  case 4: // move object
    box.html($("#templateCopyObject").html());
    box.find('#source').html("_(Objects to move)_: <?=$bulk?>");
    box.find('#target').val("<?=$target?>").prop('disabled',true);
    var height = 630;
    break;
  case 9: // change owner
    box.html($("#templateChangeOwner").html());
    box.find('#source').html("_(Objects to change)_: <?=$bulk?>");
    box.find('#target').prop('disabled',true);
    var height = 330;
    break;
  case 10: // change permission
    box.html($("#templateChangePermission").html());
    box.find('#source').html("_(Objects to change)_: <?=$bulk?>");
    box.find('#owner').prop('disabled',true);
    box.find('#group').prop('disabled',true);
    box.find('#other').prop('disabled',true);
    var height = 330;
    break;
<?endif;?>
  }
  box.find('#exist').prop('disabled',true);
  box.dialog({
    title: "<?=$title?>",
    resizable: false,
    width: 900,
    height: height,
    modal: true,
    show: {effect:'fade', duration:250},
    hide: {effect:'fade', duration:250},
    buttons: {
      "_(Proceed)_": function(){
        return;
      },
      "_(Cancel)_": function(){
        $.post('/plugins/dynamix.file.manager/include/FileManager.php',{action:99},function(){setTimeout(loadList,500);});
        fileManager('stop');
        box.dialog('close');
      }
    }
  });
  fileManager('start');
  dialogStyle();
}
<?else:?>
var filemonitor = new NchanSubscriber('/sub/filemonitor',{subscriber:'websocket'});
filemonitor.on('message', function(state) {
  if (state==1 && !timers.filemonitor) timers.filemonitor = setTimeout(refresh,1000);
});
setTimeout(function(){filemonitor.start();},3000);
<?endif;?>

function doAction(action,title,id) {
  var link   = id.substr(0,1)=='/';
  var source = link ? id : data($('#'+id));
  var path   = source.substr(1).split('/');
  var access = ['mnt','boot'];
  if (!access.includes(path[0])) return;
  var user   = /^(user0?|rootshare)$/.test(path[1]);
  var root   = '/'+path[0]+(user ? '/'+path[1] : '');
  var share  = user||!path[2]||(link&&path.length==3) ? '' : path[2]+'/';
  var ud     = ['disks','remotes'].includes(path[1]); // unassigned devices
  var match  = ud||user ? '' : '^(?!.*(user0?|rootshare)).*$';
  var name   = path.pop()||path.pop();
  var hdlink = "<?=$var['fuse_directio']==1?'1':''?>";
  box = $("#dialogWindow");
  switch (action) {
  case 0: // create folder
    box.html($("#templateCreateFolder").html());
    source = "<?=$dir?>";
    var height = 330;
    break;
  case 1: // delete folder
    box.html($("#templateDeleteFolder").html());
    box.find('#source').html(source.strip());
    var height = 330;
    break;
  case 2: // rename folder
    box.html($("#templateRenameFolder").html());
    box.find('#source').html(name);
    box.find('#target').val(name);
    var height = 330;
    break;
  case 3: // copy folder
    box.html($("#templateCopyFolder").html());
    box.find('#source').html(source.strip());
    box.find('#target').attr('data-pickroot',root).attr('data-picktop',root).attr('data-pickmatch',match).fileTreeAttach(null,null,function(path){
      var bits = path.substr(1).split('/');
      var auto = bits.length>3 ? '' : share;
      box.find('#target').val(path+auto).change();
    });
    var height = 630;
    break;
  case 4: // move folder
    box.html($("#templateMoveFolder").html());
    box.find('#source').html(source.strip());
    box.find('#target').attr('data-pickroot',root).attr('data-picktop',root).attr('data-pickmatch',match).fileTreeAttach(null,null,function(path){
      var bits = path.substr(1).split('/');
      var auto = bits.length>3 ? '' : share;
      box.find('#target').val(path+auto).change();
    });
    var height = 630;
    break;
  case 5: // delete file
    box.html($("#templateDeleteFile").html());
    box.find('#source').html(source);
    var height = 330;
    break;
  case 6: // rename file
    box.html($("#templateRenameFile").html());
    box.find('#source').html(name);
    box.find('#target').val(name);
    var height = 330;
    break;
  case 7: // copy file
    box.html($("#templateCopyFile").html());
    box.find('#source').html(source);
    box.find('#target').attr('data-pickroot',root).attr('data-picktop',root).attr('data-pickmatch',match).fileTreeAttach(null,null,function(path){
      var bits = path.substr(1).split('/');
      var auto = bits.length>3 ? '' : share;
      box.find('#target').val(path+auto).change();
    });
    var height = 630;
    break;
  case 8: // move file
    box.html($("#templateMoveFile").html());
    box.find('#source').html(source);
    box.find('#target').attr('data-pickroot',root).attr('data-picktop',root).attr('data-pickmatch',match).fileTreeAttach(null,null,function(path){
      var bits = path.substr(1).split('/');
      var auto = bits.length>3 ? '' : share;
      box.find('#target').val(path+auto).change();
    });
    var height = 630;
    break;
  case 9: // change owner
    box.html($("#templateChangeOwner").html());
    var owner = $('#'+id.bring('owner')).text();
    box.find('#source').html(source.strip());
    box.find('#target').val(owner);
    var height = 330;
    break;
  case 10: // change permission
    box.html($("#templateChangePermission").html());
    var perm = $('#'+id.bring('perm')).text();
    box.find('#source').html(source.strip());
    box.find('#owner').val('u-'+perm.substr(1,2).patch());
    box.find('#group').val('g-'+perm.substr(4,2).patch());
    box.find('#other').val('o-'+perm.substr(7,2).patch());
    var height = 330;
    break;
  case 11: // download file
    downloadFile(source,name);
    break;
  case 12: // calculate occupied space
    timers.calc = setTimeout(function(){$('div.spinner.fixed').show('slow');},100);
    $.post('/plugins/dynamix.file.manager/include/Browse.php',{mode:'calc', source:encodeURIComponent(source)},function(text){
      clearTimeout(timers.calc);
      $('div.spinner.fixed').hide('slow');
      swal({title:"_(Calculate Occupied Space)_",text:text,html:true,confirmButtonText:"_(Ok)_"});
    });
    break;
  }
  if (action > 10) return;
  box.dialog({
    title: title,
    resizable: false,
    width: 900,
    height: height,
    modal: true,
    show: {effect:'fade', duration:250},
    hide: {effect:'fade', duration:250},
    buttons: {
      "_(Proceed)_": function(){
        if (running) return;
        var target = box.find('#target');
        if (target.length) {
          target = target.val();
          switch (action) {
          case 0: // create folder
          case 2: // rename folder
          case 6: // rename file
            var valid = /^[^\/]*$/; // no slashes allowed
            break;
          case 9: // change owner
            target += (target=='root' ? ':root' : ':users');
            var valid = /.+/;
            break;
          case 10: // change permission
            target = [];
            target.push(box.find('#owner').val());
            target.push(box.find('#group').val());
            target.push(box.find('#other').val());
            target = target.join(',')+',ugo+X';
            var valid = /.+/;
            break;
          default:
            var valid = ud ? /^\/mnt\/.+/ : (user ? /^\/mnt\/(user0?|rootshare)\/.+/ : /^\/mnt\/(?!.*(user0?|rootshare)).+$|^\/boot\/.+/); // disallow mixing of disk and user shares
            break;
          }
          if (!target || !valid.test(target)) {errorTarget(); return;}
        } else target = '';
        $('span.text').removeClass('orange-text').html("_(Running)_...");
        box.find('#target').prop('disabled',true);
        box.find('#exist').prop('disabled',true);
        if (action==10) {
          box.find('#owner').prop('disabled',true);
          box.find('#group').prop('disabled',true);
          box.find('#other').prop('disabled',true);
        }
        fileManager('start');
        $.post('/plugins/dynamix.file.manager/include/FileManager.php',{action:action,title:encodeURIComponent(title),source:encodeURIComponent(source),target:encodeURIComponent(target),hdlink:hdlink,exist:box.find('#exist').val()});
      },
      "_(Cancel)_": function(){
        if (running) $.post('/plugins/dynamix.file.manager/include/FileManager.php',{action:99},function(){setTimeout(loadList,500);});
        fileManager('stop');
        box.dialog('close');
      }
    }
  });
  dialogStyle();
}
function doActions(action,title) {
  var source = [], type = [], owner = [], perm = [];
  if (action > 0) {
    $('i[id^="check_"]').each(function(){
      if ($(this).prop('id')!='check_0' && $(this).hasClass('fa-check-square-o')) {
        var id = $(this).prop('id');
        source.push(data($('#'+id.fetch('row'))));
        type.push($('#'+id.fetch('row')).attr('type'));
        owner.push($('#'+id.fetch('owner')).text());
        perm.push($('#'+id.fetch('perm')).text());
      }
    });
    var bulk   = source.length > 1;
    var path   = source[0].substr(1).split('/');
    var access = ['mnt','boot'];
    if (!access.includes(path[0])) return;
    var user   = /^(user0?|rootshare)$/.test(path[1]);
    var root   = '/'+path[0]+(user ? '/'+path[1] : '');
    var share  = user||!path[2] ? '' : path[2]+'/';
    var ud     = ['disks','remotes'].includes(path[1]); // unassigned devices
    var match  = ud||user ? '' : '^(?!.*(user0?|rootshare)).*$';
    var name   = path.pop()||path.pop();
    var hdlink = "<?=$var['fuse_directio']==1?'1':''?>";
    if (bulk) {
      var u = false, d = false;
      for (var i=0,s; s=source[i]; i++) {
        var p = s.substr(1).split('/');
        if (/^user0?$/.test(p[1])) u = true; else d = true;
      }
      if (u && d) {errorSource(); return;} // disallow mixing of disk and user shares
    }
  }
  box = $("#dialogWindow");
  switch (action) {
  case 0: // create folder
    box.html($("#templateCreateFolder").html());
    source[0] = "<?=$dir?>";
    var height = 330;
    break;
  case 1: // delete object
    box.html($("#templateDeleteObject").html());
    box.find('#source').html(bulk ? "_(Objects to delete)_: "+source.length : source[0].strip());
    var height = 330;
    break;
  case 2: // rename object
    if (!bulk) {
      box.html($("#templateRenameObject").html());
      box.find('#source').html(name);
      box.find('#target').val(name);
      var height = 330;
    } else {
      box.html($("#templateMoveObject").html());
      box.find('#source').html("_(Objects to move)_: "+source.length);
      box.find('#target').attr('data-pickroot',root).attr('data-picktop',root).attr('data-pickmatch',match).attr('data-pickfilter','HIDE_FILES_FILTER');
      box.find('#target').fileTreeAttach(null,null,function(path){
        var bits = path.substr(1).split('/');
        var auto = bits.length>3 ? '' : share;
        box.find('#target').val(path+auto).change();
      });
      action = 4; // change to move operation
      var height = 630;
    }
    break;
  case 3: // copy object
    box.html($("#templateCopyObject").html());
    box.find('#source').html(bulk ? "_(Objects to copy)_: "+source.length : source[0].strip());
    box.find('#target').attr('data-pickroot',root).attr('data-picktop',root).attr('data-pickmatch',match);
    if (bulk || type[0]=='d') box.find('#target').attr('data-pickfilter','HIDE_FILES_FILTER');
    box.find('#target').fileTreeAttach(null,null,function(path){
      var bits = path.substr(1).split('/');
      var auto = bits.length>3 ? '' : share;
      box.find('#target').val(path+auto).change();
    });
    var height = 630;
    break;
  case 4: // move object
    box.html($("#templateMoveObject").html());
    box.find('#source').html(bulk ? "_(Objects to move)_: "+source.length : source[0].strip());
    box.find('#target').attr('data-pickroot',root).attr('data-picktop',root).attr('data-pickmatch',match);
    if (bulk || type[0]=='d') box.find('#target').attr('data-pickfilter','HIDE_FILES_FILTER');
    box.find('#target').fileTreeAttach(null,null,function(path){
      var bits = path.substr(1).split('/');
      var auto = bits.length>3 ? '' : share;
      box.find('#target').val(path+auto).change();
    });
    var height = 630;
    break;
  case 9: // change owner
    box.html($("#templateChangeOwner").html());
    box.find('#source').html(bulk ? "_(Objects to change)_: "+source.length : source[0].strip());
    if (!bulk) box.find('#target').val(owner[0]);
    var height = 330;
    break;
  case 10: // change permission
    box.html($("#templateChangePermission").html());
    box.find('#source').html(bulk ? "_(Objects to change)_: "+source.length : source[0].strip());
    if (!bulk) {
      box.find('#owner').val('u-'+perm[0].substr(1,2).patch());
      box.find('#group').val('g-'+perm[0].substr(4,2).patch());
      box.find('#other').val('o-'+perm[0].substr(7,2).patch());
    }
    var height = 330;
    break;
  case 12: // calculate occupied space
    timers.calc = setTimeout(function(){$('div.spinner.fixed').show('slow');},100);
    $.post('/plugins/dynamix.file.manager/include/Browse.php',{mode:'calc', source:encodeURIComponent(source.join('\n'))},function(text){
      clearTimeout(timers.calc);
      $('div.spinner.fixed').hide('slow');
      swal({title:"_(Calculate Occupied Space)_",text:text,html:true,confirmButtonText:"_(Ok)_"});
    });
    break;
  }
  if (action > 10) return;
  box.dialog({
    title: title,
    resizable: false,
    width: 900,
    height: height,
    modal: true,
    show: {effect:'fade', duration:250},
    hide: {effect:'fade', duration:250},
    buttons: {
      "_(Proceed)_": function(){
        if (running) return;
        var target = box.find('#target');
        if (target.length) {
          target = target.val();
          switch (action) {
          case 0: // create folder
            bulk = false;
          case 2: // rename object
            var valid = /^[^\/]*$/; // no slashes allowed
            break;
          case 9: // change owner
            target += (target=='root' ? ':root' : ':users');
            var valid = /.+/;
            bulk = false;
            break;
          case 10: // change permission
            target = [];
            target.push(box.find('#owner').val());
            target.push(box.find('#group').val());
            target.push(box.find('#other').val());
            target = target.join(',')+',ugo+X';
            var valid = /.+/;
            bulk = false;
            break;
          default:
            var valid = ud ? /\/mnt\/.+/ : (user ? /^\/mnt\/(user0?|rootshare)\/.+/ : /^\/mnt\/(?!.*(user0?|rootshare)).+$|^\/boot\/.+/); // disallow mixing of disk and user shares
            break;
          }
          if (!target || !valid.test(target)) {errorTarget(); return;}
        } else target = '';
        if (bulk && target.length>0 && target.substr(-1)!='/') target += '/';
        box.find('#target').prop('disabled',true);
        box.find('#exist').prop('disabled',true);
        if (action==10) {
          box.find('#owner').prop('disabled',true);
          box.find('#group').prop('disabled',true);
          box.find('#other').prop('disabled',true);
        }
        $('span.text').removeClass('orange-text').html("_(Running)_...");
        fileManager('start');
        $.post('/plugins/dynamix.file.manager/include/FileManager.php',{action:action,title:encodeURIComponent(title),source:encodeURIComponent(source.join('\r')),target:encodeURIComponent(target),hdlink:hdlink,exist:box.find('#exist').val()});
      },
      "_(Cancel)_": function(){
        if (running) $.post('/plugins/dynamix.file.manager/include/FileManager.php',{action:99},function(){setTimeout(loadList,500);});
        fileManager('stop');
        box.dialog('close');
      }
    }
  });
  dialogStyle();
}
function expert() {
  $.cookie('expert')==null ? $.cookie('expert','expert',{path:'/'}) : $.removeCookie('expert',{path:'/'});
  loadList();
}
function stop() {
  window.onbeforeunload = null;
  loadList();
}
function downloadFile(source) {
  var a = document.createElement('a');
  a.setAttribute('href',source);
  a.setAttribute('download',source.split('/').pop());
  a.style.display = 'none';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
}
function uploadFile(files,index,start) {
  var file = files[index];
  var slice = 4000 * 1024;
  var next = start + slice + 1;
  var blob = file.slice(start, next);
  reader.onloadend = function(e){
    if (e.target.readyState !== FileReader.DONE) return;
    $.post('/plugins/dynamix.file.manager/include/Browse.php',{mode:'upload', file:encodeURIComponent("<?=$dir?>/"+file.name), start:start, data:e.target.result, cancel:cancel},function(reply){
      if (reply=='stop') stop();
      if (next < file.size) {
        var total = 0;
        for (var i=0,f; f=files[i]; i++) {
          if (i < index) start += f.size;
          total += f.size;
        }
        var percent = Math.floor((start + slice) / total * 100);
        $('#uploadStatus').html("_(Uploading)_&nbsp;&nbsp;"+percent+"%<span class='orange-text' style='margin-left:12px'> ["+(index+1)+'/'+files.length+']&nbsp;&nbsp;'+file.name+"</span>");
        uploadFile(files,index,next);
      } else if (index < files.length-1) {
        uploadFile(files,index+1,0);
      } else stop();
    });
  };
  reader.readAsDataURL(blob);
}
var reader = {};
var cancel = 0;
function startUpload(files) {
  reader = new FileReader();
  window.onbeforeunload = function(e){return '';};
  $('#uploadButton').val("_(Cancel)_").prop('onclick',null).off('click').click(function(){cancel=1;});
  uploadFile(files,0,0);
}
function filter(ext) {
  $('td.ext').each(function(){
    if ($(this).attr('data').search(ext)==-1) $(this).parent().hide(); else $(this).parent().show();
  });
}
function toggleTime(init) {
  $('.my_time').toggle();
  $('.my_age').toggle();
  if (init) return;
  $.cookie('my_time')==null ? $.cookie('my_time','age',{path:'/'}) : $.removeCookie('my_time',{path:'/'});
}
function loadList() {
  timers.browse = setTimeout(function(){$('div.spinner.fixed').show();},1000);
  var col = $.cookie('col')||2;
  var dir = $.cookie('dir')||0;
  $.get('/plugins/dynamix.file.manager/include/Browse.php',{dir:encodeURIComponent("<?=$dir?>"),path:"<?=$path?>",block:$.cookie('expert')||''},function(data){
    clearTimeout(timers.browse);
    $('div.spinner.fixed').hide();
    table.find('tbody,tfoot').remove();
    thead.after(data);
    table.tablesorter({headers:{0:{sorter:false},8:{sorter:false}},sortList:[[col,dir],[2,0]],sortAppend:[[2,0]],textAttribute:'data'});
    if ($.cookie('my_time')!=null) toggleTime(true);
<?if ($display['resize']):?>
    resize();
    $(window).bind('resize',function(){resize();});
<?endif;?>
  });
}
$(function(){
  caPluginUpdateCheck('dynamix.file.manager.plg',{name:'Dynamix File Manager'});
  $('span.left').append('<span class="right"><span class="filter"><input type="text" class="filter" oninput="filter(this.value)" autocomplete="off" spellcheck="false" placeholder="_(file type)_"><i class="fa fa-filter"></i></span><i class="fa fa-toggle-off" onclick="toggleTime()" style="cursor:pointer;margin-left:20px" title="_(Toggle Time/Age display)_"></i><a href="#" class="none" title=""><input type="checkbox" class="expert"></a></span>');
  $('.expert').switchButton({labels_placement:"left", on_label:"_(Advanced Mode)_", off_label:"_(Basic Mode)_", checked:$.cookie('expert')!=null});
  $('.expert').change(function(){expert();});
  shortcut.add('F2',function(){expert();});
  if ($.cookie('expert')==null) $('a.none').attr("title","_(Restricted access)_"); else $('a.none').attr("title","_(Unrestricted access)_");
  table = $('table.indexer');
  thead = table.find('thead');
  table.bind('sortEnd',function(e,t){
    var sort = e.target.config.sortList.toString().split(',');
    $.cookie('col',sort[0],{path:'/'});
    $.cookie('dir',sort[1],{path:'/'});
  });
  loadList();
<?if ($running):?>
  showDialog();
<?endif;?>
});
</script>
<div class="autoheight">
<table class="indexer tablesorter shift"><thead><tr><th><?if($dir){?><i id="check_0" class="fa fa-fw fa-square-o" onclick="selectAll()"></i><?}?></th><th>_(Type)_</th><th class='sorter-text'>_(Name)_</th><th>_(Owner)_</th><th>_(Permission)_</th><th>_(Size)_</th><th>_(Last Modified)_</th><th style="width:200px">_(Location)_</th><th>_(Action)_</th></tr></thead></table>
</div>
<input type="button" value="_(Done)_" onclick="done('Browse')">
<input type="button" value="_(Delete)_" class="extra" onclick="doActions(1,this.value)" disabled>
<input type="button" value="_(Copy)_" class="extra" onclick="doActions(3,this.value)" disabled>
<input type="button" value="_(Move)_" class="extra" onclick="doActions(4,this.value)" disabled>
<input type="button" value="_(Rename)_" class="rename" onclick="doActions(2,this.value)" disabled>
<input type="button" value="_(Owner)_" class="extra" onclick="doActions(9,this.value)" disabled>
<input type="button" value="_(Permission)_" class="extra" onclick="doActions(10,this.value)" disabled>
<input type="button" value="_(Calculate)_" class="extra" onclick="doActions(12,this.value)" disabled>
<input type="button" value="_(Create)_" onclick="doActions(0,this.value)"<?if(!$dir||$isshare){?> disabled<?}?>>
<input type="button" value="_(Upload)_" id="uploadButton" onclick="$('#upload').click()"<?if (!$dir||$isshare){?> disabled<?}?>><span id="uploadStatus"></span>

<input type="file" id="upload" value="" onchange="startUpload(this.files)" multiple>
<div id="dialogWindow"></div>

<div markdown="1" id="templateCreateFolder" class="template">
<html <?=$display['rtl']?>lang="<?=strtok($locale,'_')?:'en'?>">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=1600">
<meta name="robots" content="noindex, nofollow">
<meta name="referrer" content="same-origin">
<link type="text/css" rel="stylesheet" href="<?autov("/webGui/styles/default-fonts.css")?>">
</head>
<body>
&nbsp;
: &nbsp;

_(New folder name)_:
: <input type="text" id="target" autocomplete="off" spellcheck="false" value="">

&nbsp;
: <span class="text"></span>

<div class="info"><i class="fa fa-warning"></i>_(This creates a folder at the current level)_</div>
</body>
</html>
</div>

<div markdown="1" id="templateDeleteFolder" class="template">
<html <?=$display['rtl']?>lang="<?=strtok($locale,'_')?:'en'?>">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=1600">
<meta name="robots" content="noindex, nofollow">
<meta name="referrer" content="same-origin">
<link type="text/css" rel="stylesheet" href="<?autov("/webGui/styles/default-fonts.css")?>">
</head>
<body>
<?=_("$Folder name")?>:
: <span id="source"></span>

&nbsp;
: <span class="text"></span>

<div class="info"><i class="fa fa-warning"></i><?=_("This deletes the $folder and all its content")?></div>
</body>
</html>
</div>

<div markdown="1" id="templateRenameFolder" class="template">
<html <?=$display['rtl']?>lang="<?=strtok($locale,'_')?:'en'?>">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=1600">
<meta name="robots" content="noindex, nofollow">
<meta name="referrer" content="same-origin">
<link type="text/css" rel="stylesheet" href="<?autov("/webGui/styles/default-fonts.css")?>">
</head>
<body>
_(Current folder name)_:
: <span id="source"></span>

&nbsp;
: _(rename to)_ ...

_(New folder name)_:
: <input type="text" id="target" autocomplete="off" spellcheck="false" value="">

&nbsp;
: <span class="text"></span>

<div class="info"><i class="fa fa-warning"></i>_(This renames the folder to the new name)_</div>
</body>
</html>
</div>

<div markdown="1" id="templateCopyFolder" class="template">
<html <?=$display['rtl']?>lang="<?=strtok($locale,'_')?:'en'?>">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=1600">
<meta name="robots" content="noindex, nofollow">
<meta name="referrer" content="same-origin">
<link type="text/css" rel="stylesheet" href="<?autov("/webGui/styles/default-fonts.css")?>">
</head>
<body>
<?=_("Source $folder")?>:
: <span id="source"></span>

&nbsp;
: _(copy to)_ ...

<?=_("Target $folder")?>:
: <input type="text" id="target" autocomplete="off" spellcheck="false" value="" data-pickcloseonfile="true" data-pickfolders="true" data-pickfilter="HIDE_FILES_FILTER" data-pickmatch="" data-pickroot="" data-picktop="">

&nbsp;
: &nbsp;

_(Overwrite existing files)_ <input type="checkbox" id="exist" value="" onchange="this.value=this.checked?'1':''">
: <span class="text"></span>

<div class="info"><i class="fa fa-warning"></i><?=_("This copies the $folder and all its content to another $folder")?></div>
</body>
</html>
</div>

<div markdown="1" id="templateMoveFolder" class="template">
<html <?=$display['rtl']?>lang="<?=strtok($locale,'_')?:'en'?>">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=1600">
<meta name="robots" content="noindex, nofollow">
<meta name="referrer" content="same-origin">
<link type="text/css" rel="stylesheet" href="<?autov("/webGui/styles/default-fonts.css")?>">
</head>
<body>
<?=_("Source $folder")?>:
: <span id="source"></span>

&nbsp;
: _(move to)_ ...

<?=_("Target $folder")?>:
: <input type="text" id="target" autocomplete="off" spellcheck="false" value="" data-pickcloseonfile="true" data-pickfolders="true" data-pickfilter="HIDE_FILES_FILTER" data-pickmatch="" data-pickroot="" data-picktop="">

&nbsp;
: &nbsp;

_(Overwrite existing files)_ <input type="checkbox" id="exist" value="" onchange="this.value=this.checked?'1':''">
: <span class="text"></span>

<div class="info"><i class="fa fa-warning"></i><?=_("This moves the $folder and all its content to another $folder")?></div>
</body>
</html>
</div>

<div markdown="1" id="templateDeleteFile" class="template">
<html <?=$display['rtl']?>lang="<?=strtok($locale,'_')?:'en'?>">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=1600">
<meta name="robots" content="noindex, nofollow">
<meta name="referrer" content="same-origin">
<link type="text/css" rel="stylesheet" href="<?autov("/webGui/styles/default-fonts.css")?>">
</head>
<body>
_(File name)_:
: <span id="source"></span>

&nbsp;
: <span class="text"></span>

<div class="info"><i class="fa fa-warning"></i>_(This deletes the selected file)_</div>
</body>
</html>
</div>

<div markdown="1" id="templateRenameFile" class="template">
<html <?=$display['rtl']?>lang="<?=strtok($locale,'_')?:'en'?>">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=1600">
<meta name="robots" content="noindex, nofollow">
<meta name="referrer" content="same-origin">
<link type="text/css" rel="stylesheet" href="<?autov("/webGui/styles/default-fonts.css")?>">
</head>
<body>
_(Current file name)_:
: <span id="source"></span>

&nbsp;
: _(rename to)_ ...

_(New file name)_:
: <input type="text" id="target" autocomplete="off" value="">

&nbsp;
: <span class="text"></span>

<div class="info"><i class="fa fa-warning"></i>_(This renames the selected file)_</div>
</body>
</html>
</div>

<div markdown="1" id="templateCopyFile" class="template">
<html <?=$display['rtl']?>lang="<?=strtok($locale,'_')?:'en'?>">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=1600">
<meta name="robots" content="noindex, nofollow">
<meta name="referrer" content="same-origin">
<link type="text/css" rel="stylesheet" href="<?autov("/webGui/styles/default-fonts.css")?>">
</head>
<body>
_(Source file)_:
: <span id="source"></span>

&nbsp;
: _(copy to)_ ...

_(Target file)_:
: <input type="text" id="target" autocomplete="off" spellcheck="false" value="" data-pickcloseonfile="true" data-pickfolders="true" data-pickfilter="" data-pickmatch="" data-pickroot="" data-picktop="">

&nbsp;
: &nbsp;

_(Overwrite existing file)_ <input type="checkbox" id="exist" value="" onchange="this.value=this.checked?'1':''">
: <span class="text"></span>

<div class="info"><i class="fa fa-warning"></i>_(This copies the selected file)_</div>
</body>
</html>
</div>

<div markdown="1" id="templateMoveFile" class="template">
<html <?=$display['rtl']?>lang="<?=strtok($locale,'_')?:'en'?>">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=1600">
<meta name="robots" content="noindex, nofollow">
<meta name="referrer" content="same-origin">
<link type="text/css" rel="stylesheet" href="<?autov("/webGui/styles/default-fonts.css")?>">
</head>
<body>
_(Source file)_:
: <span id="source"></span>

&nbsp;
: _(move to)_ ...

_(Target file)_:
: <input type="text" id="target" autocomplete="off" spellcheck="false" value="" data-pickcloseonfile="true" data-pickfolders="true" data-pickfilter="" data-pickmatch="" data-pickroot="" data-picktop="">

&nbsp;
: &nbsp;

_(Overwrite existing file)_ <input type="checkbox" id="exist" value="" onchange="this.value=this.checked?'1':''">
: <span class="text"></span>

<div class="info"><i class="fa fa-warning"></i>_(This moves the selected file)_</div>
</body>
</html>
</div>

<div markdown="1" id="templateDeleteObject" class="template">
<html <?=$display['rtl']?>lang="<?=strtok($locale,'_')?:'en'?>">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=1600">
<meta name="robots" content="noindex, nofollow">
<meta name="referrer" content="same-origin">
<link type="text/css" rel="stylesheet" href="<?autov("/webGui/styles/default-fonts.css")?>">
</head>
<body>
_(Source)_:
: <span id="source"></span>

&nbsp;
: <span class="text"></span>

<div class="info"><i class="fa fa-warning"></i>_(This deletes all selected sources)_</div>
</body>
</html>
</div>

<div markdown="1" id="templateRenameObject" class="template">
<html <?=$display['rtl']?>lang="<?=strtok($locale,'_')?:'en'?>">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=1600">
<meta name="robots" content="noindex, nofollow">
<meta name="referrer" content="same-origin">
<link type="text/css" rel="stylesheet" href="<?autov("/webGui/styles/default-fonts.css")?>">
</head>
<body>
_(Source)_:
: <span id="source"></span>

&nbsp;
: _(rename to)_ ...

_(Target)_:
: <input type="text" id="target" autocomplete="off" spellcheck="false" value="">

<div class="info"><i class="fa fa-warning"></i>_(This renames the selected source)_</div>
</body>
</html>
</div>

<div markdown="1" id="templateCopyObject" class="template">
<html <?=$display['rtl']?>lang="<?=strtok($locale,'_')?:'en'?>">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=1600">
<meta name="robots" content="noindex, nofollow">
<meta name="referrer" content="same-origin">
<link type="text/css" rel="stylesheet" href="<?autov("/webGui/styles/default-fonts.css")?>">
</head>
<body>
_(Source)_:
: <span id="source"></span>

&nbsp;
: _(copy to)_ ...

_(Target)_:
: <input type="text" id="target" autocomplete="off" spellcheck="false" value="" data-pickcloseonfile="true" data-pickfolders="true" data-pickfilter="" data-pickmatch="" data-pickroot="" data-picktop="">

&nbsp;
: &nbsp;

_(Overwrite existing files)_ <input type="checkbox" id="exist" value="" onchange="this.value=this.checked?'1':''">
: <span class="text"></span>

<div class="info"><i class="fa fa-warning"></i>_(This copies all the selected sources)_</div>
</body>
</html>
</div>

<div markdown="1" id="templateMoveObject" class="template">
<html <?=$display['rtl']?>lang="<?=strtok($locale,'_')?:'en'?>">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=1600">
<meta name="robots" content="noindex, nofollow">
<meta name="referrer" content="same-origin">
<link type="text/css" rel="stylesheet" href="<?autov("/webGui/styles/default-fonts.css")?>">
</head>
<body>
_(Source)_:
: <span id="source"></span>

&nbsp;
: _(move to)_ ...

_(Target)_:
: <input type="text" id="target" autocomplete="off" spellcheck="false" value="" data-pickcloseonfile="true" data-pickfolders="true" data-pickfilter="" data-pickmatch="" data-pickroot="" data-picktop="">

&nbsp;
: &nbsp;

_(Overwrite existing files)_ <input type="checkbox" id="exist" value="" onchange="this.value=this.checked?'1':''">
: <span class="text"></span>

<div class="info"><i class="fa fa-warning"></i>_(This moves all the selected sources)_</div>
</body>
</html>
</div>

<div markdown="1" id="templateChangeOwner" class="template">
<html <?=$display['rtl']?>lang="<?=strtok($locale,'_')?:'en'?>">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=1600">
<meta name="robots" content="noindex, nofollow">
<meta name="referrer" content="same-origin">
<link type="text/css" rel="stylesheet" href="<?autov("/webGui/styles/default-fonts.css")?>">
</head>
<body>
_(Source)_:
: <span id="source"></span>

&nbsp;
: _(change owner)_ ...

_(New owner)_:
: <select id="target">
<?foreach ($users as $user) echo mk_option(0,$user['name'],$user['name']);
  echo mk_option(0,'nobody','nobody');
?></select>

&nbsp;
: <span class="text"></span>

<div class="info"><i class="fa fa-warning"></i>_(This changes the owner of the source recursively)_</div>
</body>
</html>
</div>

<div markdown="1" id="templateChangePermission" class="template">
<html <?=$display['rtl']?>lang="<?=strtok($locale,'_')?:'en'?>">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=1600">
<meta name="robots" content="noindex, nofollow">
<meta name="referrer" content="same-origin">
<link type="text/css" rel="stylesheet" href="<?autov("/webGui/styles/default-fonts.css")?>">
</head>
<body>
_(Source)_:
: <span id="source"></span>

&nbsp;
: _(change permission)_ ...

_(New permission)_:
: <input type="hidden" id="target" value="">
  _(Owner)_:<select id="owner" class="narrow">
  <?=mk_option(0,'u-rwx',_('No Access'))?>
  <?=mk_option(0,'u-wx+r',_('Read-only'))?>
  <?=mk_option(0,'u-x+rw',_('Read/Write'))?>
  </select>
  _(Group)_:<select id="group" class="narrow">
  <?=mk_option(0,'g-rwx',_('No Access'))?>
  <?=mk_option(0,'g-wx+r',_('Read-only'))?>
  <?=mk_option(0,'g-x+rw',_('Read/Write'))?>
  </select>
  _(Other)_:<select id="other" class="narrow">
  <?=mk_option(0,'o-rwx',_('No Access'))?>
  <?=mk_option(0,'o-wx+r',_('Read-only'))?>
  <?=mk_option(0,'o-x+rw',_('Read/Write'))?>
  </select>

&nbsp;
: <span class="text"></span>

<div class="info"><i class="fa fa-warning"></i>_(This changes the permission of the source recursively)_</div>
</body>
</html>
</div>

<div markdown="1" id="templateEditFile" class="template">
<!--!
<html <?=$display['rtl']?>lang="<?=strtok($locale,'_')?:'en'?>">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=1600">
<meta name="robots" content="noindex, nofollow">
<meta name="referrer" content="same-origin">
<link type="text/css" rel="stylesheet" href="<?autov("/webGui/styles/default-fonts.css")?>">
<style>div#editor{position:absolute;top:0;bottom:0;left:0;right:0;font-size:1.4rem;font-family:bitstream;line-height:1.6}</style>
</head>
<body>
<div id="editor"></div>
<script src="<?autov('/plugins/dynamix.file.manager/javascript/ace/ace.js')?>"></script>
<script src="<?autov('/plugins/dynamix.file.manager/javascript/ace/ext-modelist.js')?>"></script>
<script>
function getMode(file){
  var modelist = require('ace/ext/modelist');
  return modelist.getModeForPath(file).mode;
}
var editor = ace.edit('editor');
<?if (in_array($theme,['black','gray'])):?>
editor.setTheme('ace/theme/tomorrow_night');
<?else:?>
editor.setTheme('ace/theme/tomorrow');
<?endif;?>
var source = "{$0}";
editor.session.setMode(getMode(source));
timers.editor = setTimeout(function(){$('div.spinner.fixed').show();},1000);
$.post('/plugins/dynamix.file.manager/include/Browse.php',{mode:'edit', file:encodeURIComponent(source)},function(data){
  clearTimeout(timers.editor);
  $('div.spinner.fixed').hide();
  editor.session.setValue(data);
});
</script>
</body>
</html>
!-->
</div>

<div markdown="1" id="templateViewFile" class="template">
<!--!
<html <?=$display['rtl']?>lang="<?=strtok($locale,'_')?:'en'?>">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=1600">
<meta name="robots" content="noindex, nofollow">
<meta name="referrer" content="same-origin">
</head>
<body>
<a id="viewer" href="{$0}"></a>
<script src="<?autov('/plugins/dynamix.file.manager/javascript/EZView.js')?>"></script>
<script>
$('#viewer').EZView();
$('#viewer').click();
</script>
</body>
</html>
!-->
</div>
